# ç¬¬ 7 é˜¶æ®µï¼šSub-Agent æ¨¡å¼ (å­æ™ºèƒ½ä½“)

> **å¯¼èˆª**ï¼šé¦–é¡µ Â» è¿›é˜¶æ¶æ„
>
> â¬…ï¸ [ä¸Šä¸€ç« ï¼šMCP åè®®](./06-mcp.md) | â¡ï¸ [ä¸‹ä¸€ç« ï¼šAgent Skill](./08-agent-skill.md)

---

ä¸€ä¸ª Agent ä»€ä¹ˆéƒ½å¹²ï¼Œå°±åƒè®©ä¸€ä¸ªäººåŒæ—¶å†™ä»£ç ã€åšè®¾è®¡ã€è·‘æµ‹è¯•ã€å†™æ–‡æ¡£â€”â€”ç²¾åŠ›åˆ†æ•£ï¼Œä¸Šä¸‹æ–‡ä¹Ÿè¢«å¡æ»¡æ— å…³ä¿¡æ¯ã€‚Sub-Agent æ¨¡å¼å°±æ˜¯**åˆ†å·¥åä½œ**ã€‚

## å• Agent çš„ç“¶é¢ˆ

å½“ä»»åŠ¡å˜å¤æ‚ï¼Œå• Agent ä¼šé‡åˆ°ä¸¤ä¸ªé—®é¢˜ï¼š

| é—®é¢˜ | è¡¨ç° |
|:-----|:-----|
| **ä¸Šä¸‹æ–‡æ±¡æŸ“** | æœç´¢ä»£ç çš„ä¸­é—´ç»“æœã€æµ‹è¯•æ—¥å¿—ç­‰å æ»¡ä¸Šä¸‹æ–‡ï¼Œå½±å“åç»­å†³ç­– |
| **ä»»åŠ¡è¿‡æ‚** | Agent éœ€è¦åœ¨"å†™ä»£ç "å’Œ"æœç´¢æ–‡æ¡£"ä¹‹é—´åå¤åˆ‡æ¢ï¼Œå®¹æ˜“å‡ºé”™ |

æœ¬è´¨ä¸Šæ˜¯**ä¸€ä¸ªäººå¹²å¤ªå¤šäº‹ï¼Œè„‘å­ä¸å¤Ÿç”¨äº†**ã€‚

## Sub-Agent æ¶æ„

è§£æ³•å¾ˆç›´æ¥â€”â€”æ‹†åˆ†ä»»åŠ¡ï¼Œå§”æ´¾ç»™ä¸“é—¨çš„å­ Agentï¼š

```
ç”¨æˆ·ï¼š"å¸®æˆ‘è°ƒç ” React å’Œ Vue çš„ä¼˜ç¼ºç‚¹ï¼Œç„¶åå†™ä¸€ä¸ªæŠ€æœ¯é€‰å‹æŠ¥å‘Š"

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ä¸» Agent    â”‚  â† ç†è§£ä»»åŠ¡ã€æ‹†åˆ†ã€æ±‡æ€»
                    â”‚ (Orchestrator)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â–¼         â–¼         â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚è°ƒç ” Agent  â”‚ â”‚è°ƒç ” Agentâ”‚ â”‚å†™ä½œ Agentâ”‚
           â”‚ (React)   â”‚ â”‚ (Vue)    â”‚ â”‚ (æŠ¥å‘Š)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ¯ä¸ªå­ Agentï¼š
- æœ‰è‡ªå·±**ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡**â€”â€”äº’ä¸å¹²æ‰°
- æœ‰è‡ªå·±**ä¸“å±çš„å·¥å…·é›†**â€”â€”æœç´¢ Agent æœ‰æœç´¢å·¥å…·ï¼Œå†™ä½œ Agent æœ‰æ–‡ä»¶å·¥å…·
- åšå®Œå**åªè¿”å›ç»“æœ**â€”â€”ä¸å¸¦è¿‡ç¨‹ä¸­çš„åºŸæ–™

## æ ¸å¿ƒæ¶æ„

ç³»ç»Ÿç”±ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ç»„æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Sub-Agent System                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   è§£æ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  .agent/agents/   â”‚ â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  SubAgentRegistry â”‚             â”‚
â”‚  â”‚  *.md æ–‡ä»¶        â”‚          â”‚  (å­Agentæ³¨å†Œä¸­å¿ƒ) â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                        â”‚                         â”‚
â”‚                                        â–¼                         â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                              â”‚   SubAgentTool   â”‚                â”‚
â”‚                              â”‚  (LLMå¯è°ƒç”¨å·¥å…·)  â”‚                â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—èŒè´£

| æ¨¡å— | æ–‡ä»¶ | èŒè´£ |
|:-----|:-----|:-----|
| **SubAgentDefinition** | `src/subagents/sub-agent-types.ts` | å®šä¹‰ SubAgent æ•°æ®ç»“æ„ï¼Œæä¾› `parseSubAgentFile()` è§£æ Markdown æ–‡ä»¶ |
| **SubAgentRegistry** | `src/subagents/sub-agent-registry.ts` | å­ Agent æ³¨å†Œä¸­å¿ƒï¼šåŠ è½½ç›®å½•ã€æŒ‰åç§°æŸ¥æ‰¾ã€å†…ç½® Agent æ³¨å†Œ |
| **SubAgentTool** | `src/tools/sub-agent-tool.ts` | å®ç° Tool æ¥å£ï¼Œè®© LLM å¯ä»¥é€šè¿‡å·¥å…·è°ƒç”¨å§”æ´¾ä»»åŠ¡ç»™å­ Agent |

## SubAgent å®šä¹‰æ ¼å¼

æ¯ä¸ª SubAgent æ˜¯ä¸€ä¸ª Markdown æ–‡ä»¶ï¼Œç”± YAML frontmatter å’Œæ­£æ–‡ä¸¤éƒ¨åˆ†ç»„æˆï¼š

### SubAgentDefinition æ¥å£

```typescript
interface SubAgentDefinition {
  name: string;         // å”¯ä¸€æ ‡è¯†ï¼ˆé»˜è®¤å–æ–‡ä»¶åï¼‰
  description: string;  // æè¿°ï¼ˆç”¨äº LLM å†³ç­–é€‰æ‹©å­ Agentï¼‰
  systemPrompt: string; // Markdown æ­£æ–‡ä½œä¸ºå­ Agent çš„ç³»ç»Ÿæç¤ºè¯
  tools?: string[];     // å…è®¸çš„å·¥å…·ååˆ—è¡¨ï¼ˆä¸è®¾åˆ™ç»§æ‰¿å…¨éƒ¨ï¼‰
  model?: string;       // æ¨¡å‹ provider è¦†ç›–ï¼ˆå¦‚ "deepseek"ï¼‰
  maxTurns?: number;    // æœ€å¤§å·¥å…·è°ƒç”¨è½®æ•°
}
```

### frontmatter å­—æ®µè¯´æ˜

| å­—æ®µ | å¿…å¡« | è¯´æ˜ |
|:-----|:-----|:-----|
| `name` | å¦ | SubAgent å”¯ä¸€æ ‡è¯†ï¼Œé»˜è®¤å–æ–‡ä»¶åï¼ˆä¸å« `.md`ï¼‰ |
| `description` | å¦ | æè¿°ä¿¡æ¯ï¼Œç”¨äº LLM å†³ç­–æ—¶é€‰æ‹©åˆé€‚çš„å­ Agent |
| `tools` | å¦ | å·¥å…·ç™½åå•ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼Œä¸è®¾åˆ™ç»§æ‰¿ä¸» Agent çš„å…¨éƒ¨å·¥å…· |
| `model` | å¦ | è¦†ç›–é»˜è®¤æ¨¡å‹ providerï¼ˆå¦‚ "deepseek"ï¼‰ |
| `maxTurns` | å¦ | é™åˆ¶æœ€å¤§å·¥å…·è°ƒç”¨è½®æ•° |

### ç¤ºä¾‹æ–‡ä»¶

```markdown
---
name: code-reviewer
description: Reviews code for quality, bugs, security issues, and best practices
tools: read_file, read_folder, run_shell_command
model: deepseek
maxTurns: 15
---

You are a code reviewer specialized in identifying:
- Security vulnerabilities
- Performance issues
- Code style violations
- Missing error handling

When reviewing code, provide actionable feedback with specific line numbers...
```

## SubAgent æ³¨å†Œä¸åŠ è½½

### ç›®å½•å¸ƒå±€

SubAgent ä» `.agent/agents/` ç›®å½•åŠ è½½ï¼Œæ”¯æŒæ‰å¹³å¸ƒå±€ï¼š

```
.agent/agents/
â”œâ”€â”€ code-reviewer.md
â”œâ”€â”€ test-writer.md
â””â”€â”€ doc-writer.md
```

æ–‡ä»¶åï¼ˆå»æ‰ `.md`ï¼‰ä½œä¸ºé»˜è®¤ nameã€‚

### åŠ è½½æµç¨‹

```typescript
// åˆå§‹åŒ–ï¼šåˆ›å»ºæ³¨å†Œä¸­å¿ƒ
const subAgentRegistry = new SubAgentRegistry();

// æ³¨å†Œå†…ç½® Agentï¼ˆç¼–ç¨‹æ–¹å¼ï¼‰
subAgentRegistry.registerBuiltin(createCodebaseInvestigator());

// åŠ è½½ç”¨æˆ·å®šä¹‰çš„ Agentï¼ˆä»ç›®å½•ï¼‰
await subAgentRegistry.loadFromDirectory();  // é»˜è®¤æ‰«æ .agent/agents/
```

### å†…ç½® SubAgent

ç³»ç»Ÿå†…ç½®äº†ä¸€ä¸ª `codebase_investigator` å­ Agentï¼Œä¸“é—¨ç”¨äºä»£ç åº“åˆ†æã€æ¶æ„æ˜ å°„å’Œç†è§£ç³»ç»Ÿçº§ä¾èµ–å…³ç³»ï¼š

```typescript
// src/subagents/codebase-investigator.ts
export function createCodebaseInvestigator(): SubAgentDefinition {
  return {
    name: "codebase_investigator",
    description:
      "The specialized tool for codebase analysis, architectural mapping, " +
      "and understanding system-wide dependencies...",
    tools: ["read_file", "read_folder", "run_shell_command"],
    maxTurns: 20,
    systemPrompt: CODEBASE_INVESTIGATOR_SYSTEM_PROMPT,
  };
}
```

## LLM è°ƒç”¨ SubAgent

ä¸» Agent é€šè¿‡ `SubAgentTool` å§”æ´¾ä»»åŠ¡ç»™å­ Agentï¼š

### å·¥å…·å®šä¹‰

```json
{
  "name": "sub_agent",
  "description": "Delegate a task to a specialized sub-agent. Available agents:\n- codebase_investigator: ...",
  "parameters": {
    "agent_name": {
      "type": "string",
      "enum": ["codebase_investigator", "code-reviewer", ...]
    },
    "task": {
      "type": "string",
      "description": "A detailed description of the task..."
    }
  }
}
```

### è°ƒç”¨ç¤ºä¾‹

```json
{
  "tool": "sub_agent",
  "parameters": {
    "agent_name": "codebase_investigator",
    "task": "Analyze the authentication flow in this codebase"
  }
}
```

### æ‰§è¡Œæµç¨‹

```
LLM è°ƒç”¨ sub_agent å·¥å…·
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ ¹æ® agent_name æŸ¥æ‰¾ SubAgentDefinition       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ„å»ºå—é™ ToolRegistry                          â”‚
â”‚    - æ’é™¤ sub_agent å·¥å…·ï¼ˆé˜²æ­¢é€’å½’ï¼‰               â”‚
â”‚    - è‹¥æœ‰å·¥å…·ç™½åå•ï¼Œä»…æ³¨å†Œç™½åå•ä¸­çš„å·¥å…·           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è‹¥æŒ‡å®š modelï¼Œä¸´æ—¶åˆ‡æ¢ provider                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. åˆ›å»ºæ–° Chat å®ä¾‹ï¼ˆç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼‰                  â”‚
â”‚    - systemPrompt = å­ Agent çš„ç³»ç»Ÿæç¤ºè¯          â”‚
â”‚    - maxRounds = maxTurns                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. subChat.send(task) æ‰§è¡Œä»»åŠ¡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ¢å¤ä¹‹å‰çš„ providerï¼ˆå¦‚æœ‰åˆ‡æ¢ï¼‰                 â”‚
â”‚ 7. è¿”å›ç»“æœç»™ä¸» Agent                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç®¡ç†å‘½ä»¤

åœ¨èŠå¤©ä¸­è¾“å…¥ `/agents` å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å·²æ³¨å†Œçš„å­ Agent ä¿¡æ¯ï¼š

```
ğŸ“‹ Registered Sub-Agents (2):

  â€¢ codebase_investigator
    Description: The specialized tool for codebase analysis...
    Tools: read_file, read_folder, run_shell_command
    Model: default | Max Turns: 20

  â€¢ code-reviewer
    Description: Reviews code for quality...
    Tools: read_file, read_folder, run_shell_command
    Model: deepseek | Max Turns: 15
```

## åä½œæµç¨‹å›¾

```
ç”¨æˆ·è¯·æ±‚
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸» Agent    â”‚
â”‚  åˆ†æ & æ‹†åˆ†  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
  â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
  â–¼    â–¼    â–¼
 å­A  å­B  å­C    â† å¹¶å‘æ‰§è¡Œï¼Œå„è‡ªç‹¬ç«‹
  â”‚    â”‚    â”‚
  â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸» Agent    â”‚
â”‚  æ±‡æ€» & è¾“å‡º  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
  è¿”å›ç»™ç”¨æˆ· âœ…
```

> **Sub-Agent = å›¢é˜Ÿåä½œæ¨¡å¼ã€‚ä¸» Agent æ˜¯ Tech Leadï¼Œå­ Agent æ˜¯ä¸“æ‰å·¥ç¨‹å¸ˆã€‚å„å¹²å„çš„ï¼Œæœ€åæ±‡æ€»ã€‚**

---

> **å¯¼èˆª**ï¼šé¦–é¡µ Â» è¿›é˜¶æ¶æ„
>
> â¬…ï¸ [ä¸Šä¸€ç« ï¼šMCP åè®®](./06-mcp.md) | â¡ï¸ [ä¸‹ä¸€ç« ï¼šAgent Skill](./08-agent-skill.md)
